{%  extends "../layouts/admincomm.njk"  %}
{% block body %} 
   <div class="x-body">
       
        {% if (opt==0) %}

 <form class="layui-form">
   <input type="hidden" name="opt"  value="info" class="layui-input">
  <input type="hidden" id="L_id"  disabled="" value="{{ users[0].id }}" class="layui-input">
          <div class="layui-form-item">
              <label for="L_email" class="layui-form-label">
                  <span class="x-red">*</span>邮箱
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="L_email" name="email" value="{{ users[0].email}}" required="" lay-verify="email"
                  autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">
                  <span class="x-red">*</span>将会成为您唯一的登入名
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_nickname" class="layui-form-label">
                  <span class="x-red">*</span>昵称
              </label>
              <div class="layui-input-inline">
                  <input type="text" 
                  id="L_nickname" 
                  name="nickname"  
                  value="{{ users[0].nickname}}" 
                  required="" 
                  lay-verify="nickname"
                  autocomplete="off" class="layui-input">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_pass" class="layui-form-label">
                  <span class="x-red">*</span>性别
              </label>
              <div class="layui-input-inline">
               <input type="radio" name="gender" lay-skin="primary" title="男" id="L_pass" value="1" name="gender" required="" lay-verify="gender"
                  autocomplete="off" class="layui-input" checked="">
                 
              
                  <input type="radio" id="L_pass_0" name="gender"  title="女" value="0"  required="" lay-verify="gender"
                  autocomplete="off" class="layui-input"> 
              </div>
             
          </div>
          <div class="layui-form-item">
              <label for="L_mobile_phone" class="layui-form-label">
                  <span class="x-red">*</span>手机号
              </label>
              <div class="layui-input-inline">
                  <input type="tel" id="L_mobile_phones" name="mobile_phone" value="{{ users[0].mobile_phone}}" required="" lay-verify="mobile_phone"
                  autocomplete="off" class="layui-input">
              </div>
          </div>

          <div class="layui-form-item">
              <label for="L_address" class="layui-form-label">
                 地址
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="L_address" name="address" value="{{ users[0].address}}" required="" lay-verify="address"
                  autocomplete="off" class="layui-input">
              </div>
          </div>

          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
              </label>
              <button  class="layui-btn" lay-filter="add" lay-submit="">
                  保存
              </button>
          </div>
      </form>
        {% else %}
 <form class="layui-form">
          <div class="layui-form-item">
           <input type="hidden" name="opt"  value="pass" class="layui-input">
              <input type="hidden" id="L_id"  disabled="" value="{{ users[0].id }}" class="layui-input">
              <label for="L_username" class="layui-form-label">
                  昵称
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="L_username" name="username" disabled="" value="{{ users[0].username }}" class="layui-input">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
                  <span class="x-red">*</span>旧密码
              </label>
              <div class="layui-input-inline">
                  <input type="password" id="L_repass" name="oldpass" required="" lay-verify="required"
                  autocomplete="off" class="layui-input">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_pass" class="layui-form-label">
                  <span class="x-red">*</span>新密码
              </label>
              <div class="layui-input-inline">
                  <input type="password" id="L_pass" name="newpass" required="" lay-verify="required"
                  autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">
                  6到16个字符
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
                  <span class="x-red">*</span>确认密码
              </label>
              <div class="layui-input-inline">
                  <input type="password" id="L_repass" name="repass" required="" lay-verify="required"
                  autocomplete="off" class="layui-input">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
              </label>
              <button  class="layui-btn" lay-filter="save" lay-submit="">
                  保存
              </button>
          </div>
      </form>
        {% endif %}
        
    </div>
    <script>
     layui.use(['form','layer'], function(){
           $ = layui.jquery;
          var form = layui.form
             ,layer = layui.layer;
      $(".layui-btn").click(function(){
         saveUser()
          return false;
      })
     });

      function saveUser() {
        let data =  $(".layui-form").serialize();
         // alert(`/user/${$("#L_id").val()}`)
        // console.log(data)
         $.ajax({
            url:`/user/${$("#L_id").val()}`,
            type:"put",
            dataType:"json",
            timeout:10000,
            data:data,
            success:function(res){
               if(res.code == '0'){
                      layer.alert("操作成功", {icon: 6},function () {
                        //关闭当前frame
                       x_admin_close();
                        // 可以对父窗口进行刷新 
                       x_admin_father_reload();
                      });
                    }
                    else{
                        console.log(res.msg);
                    }
            }
        });
         return false;
      }
     
     
    
    </script>
{% endblock %}    